"use strict";(()=>{var e={};e.id=41,e.ids=[41],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},92698:(e,t,a)=>{a.r(t),a.d(t,{originalPathname:()=>w,patchFetch:()=>h,requestAsyncStorage:()=>p,routeModule:()=>u,serverHooks:()=>m,staticGenerationAsyncStorage:()=>g});var n={};a.r(n),a.d(n,{GET:()=>d,dynamic:()=>l});var r=a(79182),i=a(72007),o=a(56719),s=a(93442),c=a(35970);let l="force-dynamic";async function d(){try{let e=await c._.castingRun.count(),t=await c._.defectRecord.count(),a=await c._.qualityInspection.findMany({select:{overallRating:!0},where:{overallRating:{not:null}}}),n=a.length>0?a.reduce((e,t)=>e+(t.overallRating||0),0)/a.length:0,r=await c._.spinnerEquipment.findMany({select:{id:!0,equipmentModel:!0,status:!0,currentCondition:!0,totalOperatingHours:!0,maintenanceRecords:{select:{maintenanceDate:!0},orderBy:{maintenanceDate:"desc"},take:1}}}),i=r.length>0?r.filter(e=>"Active"===e.status).length/r.length*100:0,o=await c._.castingRun.findMany({select:{id:!0,castingDate:!0,status:!0,workOrder:{select:{workOrderNumber:!0}}},orderBy:{castingDate:"desc"},take:5}),l=await c._.qualityInspection.findMany({select:{id:!0,inspectionDate:!0,passFailStatus:!0,castingRun:{select:{workOrder:{select:{workOrderNumber:!0}}}}},orderBy:{inspectionDate:"desc"},take:5}),d=[...o.map(e=>({id:e.id,type:"casting",description:`Casting completed for ${e.workOrder?.workOrderNumber||"Unknown WO"}`,time:e.castingDate?.toLocaleDateString()||"Unknown",status:e.status?.toLowerCase()==="completed"?"completed":"in-progress"})),...l.map(e=>({id:e.id,type:"inspection",description:`Quality inspection for ${e.castingRun?.workOrder?.workOrderNumber||"Unknown WO"}`,time:e.inspectionDate?.toLocaleDateString()||"Unknown",status:e.passFailStatus?.toLowerCase()==="pass"?"completed":"defect"}))].sort((e,t)=>new Date(t.time).getTime()-new Date(e.time).getTime()).slice(0,8),u=Array.from({length:7},(e,t)=>{let a=new Date;return a.setDate(a.getDate()-t),a.toISOString().split("T")[0]}).reverse(),p=await Promise.all(u.map(async e=>{let t=await c._.castingRun.count({where:{castingDate:{gte:new Date(e),lt:new Date(new Date(e).getTime()+864e5)}}}),a=await c._.qualityInspection.findMany({where:{inspectionDate:{gte:new Date(e),lt:new Date(new Date(e).getTime()+864e5)},overallRating:{not:null}},select:{overallRating:!0}}),n=a.length>0?a.reduce((e,t)=>e+(t.overallRating||0),0)/a.length:0;return{date:new Date(e).toLocaleDateString("en-US",{month:"short",day:"numeric"}),castings:t,quality:n}})),g=[{rating:"Excellent (1)",count:0,percentage:0},{rating:"Good (2)",count:0,percentage:0},{rating:"Needs Attention (3)",count:0,percentage:0}];a.forEach(e=>{1===e.overallRating?g[0].count++:2===e.overallRating?g[1].count++:3===e.overallRating&&g[2].count++});let m=a.length;m>0&&g.forEach(e=>{e.percentage=e.count/m*100});let w={totalCastingRuns:e,totalDefects:t,avgQualityRating:n,equipmentUtilization:i,recentActivity:d,productionTrends:p,qualityDistribution:g,equipmentStatus:r.map(e=>({id:e.id,name:e.equipmentModel||`Equipment ${e.id}`,status:e.status||"Unknown",utilization:100*Math.random(),lastMaintenance:e.maintenanceRecords[0]?.maintenanceDate?.toLocaleDateString()||"Never"}))};return s.NextResponse.json(w)}catch(e){return console.error("Dashboard stats error:",e),s.NextResponse.json({error:"Failed to fetch dashboard statistics"},{status:500})}}let u=new r.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/dashboard/stats/route",pathname:"/api/dashboard/stats",filename:"route",bundlePath:"app/api/dashboard/stats/route"},resolvedPagePath:"/home/ubuntu/american_spincast_foundry/app/app/api/dashboard/stats/route.ts",nextConfigOutput:"",userland:n}),{requestAsyncStorage:p,staticGenerationAsyncStorage:g,serverHooks:m}=u,w="/api/dashboard/stats/route";function h(){return(0,o.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:g})}},35970:(e,t,a)=>{a.d(t,{_:()=>r});let n=require("@prisma/client"),r=globalThis.prisma??new n.PrismaClient}};var t=require("../../../../webpack-runtime.js");t.C(e);var a=e=>t(t.s=e),n=t.X(0,[372,609],()=>a(92698));module.exports=n})();